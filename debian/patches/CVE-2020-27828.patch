From: Markus Koschany <apo@debian.org>
Date: Fri, 11 Dec 2020 11:59:15 +0100
Subject: CVE-2020-27828

Origin: https://github.com/jasper-software/jasper/pull/253/commits/4cd52b5daac62b00a0a328451544807ddecf775f
---
 src/libjasper/jpc/jpc_enc.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/src/libjasper/jpc/jpc_enc.c b/src/libjasper/jpc/jpc_enc.c
index 39c408e..1c57b37 100644
--- a/src/libjasper/jpc/jpc_enc.c
+++ b/src/libjasper/jpc/jpc_enc.c
@@ -502,6 +502,10 @@ static jpc_enc_cp_t *cp_create(char *optstr, jas_image_t *image)
 			break;
 		case OPT_MAXRLVLS:
 			tccp->maxrlvls = atoi(jas_tvparser_getval(tvp));
+			if(tccp->maxrlvls > JPC_MAXRLVLS) {
+				jas_eprintf("invalid number of resolution levels upper than %d\n",JPC_MAXRLVLS);
+				goto error;
+			}
 			break;
 		case OPT_SOP:
 			cp->tcp.csty |= JPC_COD_SOP;
